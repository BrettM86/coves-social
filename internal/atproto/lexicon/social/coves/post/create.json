{
  "lexicon": 1,
  "id": "social.coves.post.create",
  "defs": {
    "main": {
      "type": "procedure",
      "description": "Create a new post in a community",
      "input": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["community", "type", "title"],
          "properties": {
            "community": {
              "type": "string",
              "format": "at-identifier",
              "description": "DID or handle of the community to post in"
            },
            "type": {
              "type": "string",
              "enum": ["text", "image", "video", "article", "microblog"],
              "description": "Type of post to create"
            },
            "title": {
              "type": "string",
              "maxGraphemes": 300,
              "maxLength": 3000,
              "description": "Post title (required for text, article, image, video posts)"
            },
            "text": {
              "type": "string",
              "maxGraphemes": 10000,
              "maxLength": 40000,
              "description": "Post body text"
            },
            "textFacets": {
              "type": "array",
              "description": "Rich text annotations for body",
              "items": {
                "type": "ref",
                "ref": "social.coves.richtext.facet"
              }
            },
            "images": {
              "type": "array",
              "maxLength": 10,
              "description": "Images for image posts",
              "items": {
                "type": "object",
                "required": ["image"],
                "properties": {
                  "image": {
                    "type": "blob",
                    "accept": ["image/png", "image/jpeg", "image/webp"],
                    "maxSize": 5000000
                  },
                  "alt": {
                    "type": "string",
                    "maxLength": 1000,
                    "description": "Alt text for accessibility"
                  }
                }
              }
            },
            "video": {
              "type": "object",
              "description": "Video for video posts",
              "required": ["video"],
              "properties": {
                "video": {
                  "type": "blob",
                  "accept": ["video/mp4", "video/webm"],
                  "maxSize": 100000000
                },
                "thumbnail": {
                  "type": "blob",
                  "accept": ["image/png", "image/jpeg", "image/webp"],
                  "maxSize": 1000000
                },
                "alt": {
                  "type": "string",
                  "maxLength": 1000
                }
              }
            },
            "external": {
              "type": "object",
              "description": "External link embed",
              "required": ["uri"],
              "properties": {
                "uri": {
                  "type": "string",
                  "format": "uri"
                },
                "title": {
                  "type": "string",
                  "maxLength": 300
                },
                "description": {
                  "type": "string",
                  "maxLength": 1000
                },
                "thumb": {
                  "type": "blob",
                  "accept": ["image/png", "image/jpeg", "image/webp"],
                  "maxSize": 1000000
                }
              }
            },
            "tags": {
              "type": "array",
              "maxLength": 10,
              "items": {
                "type": "string",
                "maxLength": 50
              },
              "description": "Tags for categorization"
            },
            "nsfw": {
              "type": "boolean",
              "default": false,
              "description": "Whether the post contains NSFW content"
            },
            "language": {
              "type": "string",
              "format": "language",
              "description": "Language of the post"
            }
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["uri", "cid"],
          "properties": {
            "uri": {
              "type": "string",
              "format": "at-uri",
              "description": "AT-URI of the created post"
            },
            "cid": {
              "type": "string",
              "format": "cid",
              "description": "CID of the created post"
            }
          }
        }
      },
      "errors": [
        {
          "name": "CommunityNotFound",
          "description": "Community not found"
        },
        {
          "name": "NotAuthorized",
          "description": "User is not authorized to post in this community"
        },
        {
          "name": "Banned",
          "description": "User is banned from this community"
        },
        {
          "name": "InvalidContent",
          "description": "Post content violates community rules"
        }
      ]
    }
  }
}